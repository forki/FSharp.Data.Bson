class BsonProvider
    static member GetSamples: () -> BsonProvider+Root[]
    BsonTop.CreateList((File.Open("<RESOLUTION_FOLDER>/DoubleNested.bson", Open, Read, Read) :> Stream))

    static member ReadAll: stream:System.IO.Stream -> BsonProvider+Root[]
    BsonTop.CreateList(stream)


class BsonProvider+Root : BsonProvider.Runtime.IBsonTop
    new : id:MongoDB.Bson.ObjectId -> main:BsonProvider+Main -> BsonProvider+Root
    BsonRuntime.CreateDocument([| ("_id",
                                   (id :> obj))
                                  ("main",
                                   (main :> obj)) |])

    new : bsonValue:MongoDB.Bson.BsonValue -> BsonProvider+Root
    BsonTop.Create(bsonValue, "")

    member Id: MongoDB.Bson.ObjectId with get
    let value = BsonRuntime.TryGetPropertyUnpackedWithPath(this, "_id")
    BsonRuntime.GetNonOptionalValue(value.Path, BsonRuntime.ConvertObjectId(value.BsonOpt), value.BsonOpt)

    member Main: BsonProvider+Main with get
    BsonRuntime.GetPropertyPacked(this, "main")


class BsonProvider+Main : BsonProvider.Runtime.IBsonTop
    new : title:string -> nested:BsonProvider+Nested -> BsonProvider+Main
    BsonRuntime.CreateDocument([| ("title",
                                   (title :> obj))
                                  ("nested",
                                   (nested :> obj)) |])

    new : bsonValue:MongoDB.Bson.BsonValue -> BsonProvider+Main
    BsonTop.Create(bsonValue, "")

    member Nested: BsonProvider+Nested with get
    BsonRuntime.GetPropertyPacked(this, "nested")

    member Title: string with get
    let value = BsonRuntime.TryGetPropertyUnpackedWithPath(this, "title")
    BsonRuntime.GetNonOptionalValue(value.Path, BsonRuntime.ConvertString(value.BsonOpt), value.BsonOpt)


class BsonProvider+Nested : BsonProvider.Runtime.IBsonTop
    new : nestedTitle:string -> BsonProvider+Nested
    BsonRuntime.CreateDocument([| ("nestedTitle",
                                   (nestedTitle :> obj)) |])

    new : bsonValue:MongoDB.Bson.BsonValue -> BsonProvider+Nested
    BsonTop.Create(bsonValue, "")

    member NestedTitle: string with get
    let value = BsonRuntime.TryGetPropertyUnpackedWithPath(this, "nestedTitle")
    BsonRuntime.GetNonOptionalValue(value.Path, BsonRuntime.ConvertString(value.BsonOpt), value.BsonOpt)


